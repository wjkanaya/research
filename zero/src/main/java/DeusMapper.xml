<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="mybatis.DeusMapper">
  <select id="selectMemberHistInfo" resultType="MemberHistInfo">
    select * from member_hist_info where tbl_id = #{tblId}
  </select>

  <select id="selectAllMemberHistInfo" resultType="MemberHistInfo">
    select * from member_hist_info
  </select>

  <select id="selectAllMemberYearCount" resultType="YearCount">
    select to_char(enter_date, &apos;YYYY&apos;) as year,count(*) as count
    from &quot;member_hist_info&quot; where status = &apos;0&apos; group by year order by year
  </select>

  <insert id="insertClientInfo" useGeneratedKeys="true"    keyProperty="tblId">
    insert into &quot;public&quot;.&quot;client_info&quot;
    (&quot;client_id&quot;,&quot;client_name&quot;) values
    (#{clientId,jdbcType=VARCHAR},#{clientName,jdbcType=VARCHAR})
  </insert>

  <delete id="truncateClientInfo">
 	 truncate table &quot;public&quot;.&quot;client_info&quot;
	</delete>

  <delete id="cleanClientInfoTblId">
 	 select setval(&apos;client_info_tbl_id_seq&apos;, 1, false)
  </delete>


  <insert id="insertProjectInfo" useGeneratedKeys="true"
    keyProperty="tblId">
    insert into &quot;public&quot;.&quot;project_info&quot;
     (&quot;project_id&quot;, &quot;project_name&quot;, &quot;client_id&quot;,
      &quot;start_date&quot;, &quot;end_date&quot;, &quot;project_status&quot;) values
       (#{projectId,jdbcType=VARCHAR},#{projectName,jdbcType=VARCHAR},#{clientId,jdbcType=VARCHAR},
       #{startDate,jdbcType=DATE},#{endDate,jdbcType=DATE},#{projectStatus,jdbcType=INTEGER})
  </insert>

  <delete id="truncateProjectInfo">
 	 truncate table &quot;public&quot;.&quot;project_info&quot;
	</delete>

  <delete id="cleanProjectInfoTblId">
 	 select setval(&apos;project_info_tbl_id_seq&apos;, 1, false)
  </delete>

  <update id="updateProjectInfo">
    update project_info set (
    end_date = #{endDate},
    project_status = #{projectStatus})
    where project_id = #{projectId}
  </update>


  <insert id="insertProjectEnrolledHistInfo" useGeneratedKeys="true"
    keyProperty="tblId">
    insert into &quot;public&quot;.&quot;project_enrolled_hist_info&quot;
     (&quot;member_id&quot;,&quot;project_id&quot;, &quot;branch_num&quot;,
      &quot;join_date&quot;, &quot;stop_date&quot;, &quot;stop_type&quot;,
     &quot;enrolled_status&quot;) values
       (#{memberId,jdbcType=VARCHAR},#{projectId,jdbcType=VARCHAR},#{branchNum,jdbcType=INTEGER},
        #{joinDate,jdbcType=DATE},#{stopDate,jdbcType=DATE},
       #{stopType,jdbcType=INTEGER},
       #{enrolledStatus,jdbcType=INTEGER})
  </insert>


   <select id="selectProjectEnrolledHistInfoBranchNum" resultType="Integer">
    select max(branch_num) as branch_num from project_enrolled_hist_info
    where member_id = #{memberId}  and project_id = #{projectId}
  </select>



 <update id="updateProjectEnrolledHistInfo">
  update project_enrolled_hist_info set
    (stop_date = #{stopDate},
    password = #{password},
    stop_type = #{stopType},
    enrolled_status = #{enrolledStatus})
  from (select member_id,project_id,max(branch_num) as branch_num from project_enrolled_hist_info
    where member_id = #{memberId}  and project_id = #{projectId}) maxbranchrec
  where project_enrolled_hist_info.member_id  = maxbranchrec.member_id AND
        project_enrolled_hist_info.project_id = maxbranchrec.project_id AND
        project_enrolled_hist_info.branch_num = maxbranchrec.branch_num



</update>



  <delete id="truncateProjectEnrolledHistInfo">
 	 truncate table &quot;public&quot;.&quot;project_enrolled_hist_info&quot;
	</delete>

  <delete id="cleanProjectEnrolledHistInfoTblId">
 	 select setval(&apos;project_enrolled_hist_info_tbl_id_seq&apos;, 1, false)
  </delete>

  <insert id="insertPriceTransitionInfo" useGeneratedKeys="true"
    keyProperty="tblId">
    insert into &quot;public&quot;.&quot;price_transition_info&quot;
     (&quot;member_id&quot;,&quot;menber_months&quot;,&quot;enrolled_hist_id&quot;,
      &quot;price_start_date&quot;,&quot;price&quot;) values
       (#{memberId,jdbcType=VARCHAR},#{menberMonths,jdbcType=INTEGER},#{enrolledHistId,jdbcType=VARCHAR},
        #{priceStartDate,jdbcType=DATE},#{price,jdbcType=INTEGER})
  </insert>

  <delete id="truncatePriceTransitionInfo">
 	 truncate table &quot;public&quot;.&quot;price_transition_info&quot;
	</delete>

  <delete id="cleanPriceTransitionInfoTblId">
 	 select setval(&apos;price_transition_info_tbl_id_seq&apos;, 1, false)
  </delete>




  <insert id="insertProjectMemberNumInfo" useGeneratedKeys="true"
    keyProperty="tblId">
    insert into &quot;public&quot;.&quot;project_member_num_info&quot;
     (&quot;project_id&quot;, &quot;project_months&quot;, &quot;member_num&quot;) values
       (#{projectId,jdbcType=VARCHAR},#{projectMonths,jdbcType=INTEGER},#{memberNum,jdbcType=INTEGER})
  </insert>

  <delete id="truncateProjectMemberNumInfo">
 	 truncate table &quot;public&quot;.&quot;project_member_num_info&quot;
	</delete>

  <delete id="cleanProjectMemberNumInfoTblId">
 	 select setval(&apos;project_member_num_info_tbl_id_seq&apos;, 1, false)
  </delete>

  <insert id="insertMemberHistInfo" useGeneratedKeys="true"
    keyProperty="tblId">
    insert into &quot;public&quot;.&quot;member_hist_info&quot;
     (&quot;project_id&quot;, &quot;project_name&quot;, &quot;start_date&quot;, &quot;name&quot;, &quot;enter_date&quot;, &quot;enter_old&quot;,
     &quot;status&quot;, &quot;retirement_date&quot;, &quot;retirement_type&quot;, &quot;sex&quot;,
     &quot;flesh_or_not&quot;, &quot;department&quot;, &quot;position&quot;) values
       (#{memberId,jdbcType=VARCHAR},#{startDate,jdbcType=DATE},#{name,jdbcType=VARCHAR},#{enterDate,jdbcType=DATE},
       #{enterOld,jdbcType=INTEGER},#{status,jdbcType=INTEGER},#{retirementDate,jdbcType=DATE},
       #{retirementType,jdbcType=INTEGER},#{sex,jdbcType=INTEGER},#{fleshOrNot,jdbcType=INTEGER},
       #{department,jdbcType=INTEGER},#{position,jdbcType=INTEGER})
  </insert>

  <insert id="insertManyMemberHistInfo" useGeneratedKeys="true"
    keyProperty="tblId">
    insert into &quot;public&quot;.&quot;member_hist_info&quot;
     (&quot;member_id&quot;, &quot;start_date&quot;, &quot;name&quot;, &quot;enter_date&quot;, &quot;enter_old&quot;,
     &quot;status&quot;, &quot;retirement_date&quot;, &quot;retirement_type&quot;, &quot;sex&quot;,
     &quot;flesh_or_not&quot;, &quot;department&quot;, &quot;position&quot;) values
    <foreach item="item" collection="list" separator=",">
       (#{item.memberId,jdbcType=VARCHAR},#{item.startDate,jdbcType=DATE},#{item.name,jdbcType=VARCHAR},
       #{item.enterDate,jdbcType=DATE},#{item.enterOld,jdbcType=INTEGER},#{item.status,jdbcType=INTEGER},
       #{item.retirementDate,jdbcType=DATE},#{item.retirementType,jdbcType=INTEGER},
       #{item.sex,jdbcType=INTEGER},#{item.fleshOrNot,jdbcType=INTEGER},
       #{item.department,jdbcType=INTEGER},#{item.position,jdbcType=INTEGER})
    </foreach>
  </insert>

  <update id="updateMemberHistInfo">
    update member_hist_info set (
    status = #{status},
    retirement_date = #{retirementDate},
    retirement_type = #{retirementType})
    where member_id = #{memberId}
  </update>

  <delete id="truncateMemberHistInfo">
 	 truncate table &quot;public&quot;.&quot;member_hist_info&quot;
  </delete>
  <delete id="cleanMemberHistInfoTblId">
 	 select setval(&apos;member_hist_info_tbl_id_seq&apos;, 1, false)
  </delete>

</mapper>
